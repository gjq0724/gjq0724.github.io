<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[methDiffRegion]]></title>
    <url>%2F2017%2F08%2F24%2FmethDiffRegion%2F</url>
    <content type="text"><![CDATA[##bismark处理测序数据: 对拟南芥基因组建索引 12bismark_genome_preparation --verbose --bowtie2 /mnt/S30/guojq/methylation/genome /*将tair10.fa放到/mnt/S30/guojq/methylation/genome文件夹，bismark会在这个目录下建立索引，之后使用该路径调用索引文件*/ bismark处理测序数据 12345678bismark -p 5 /mnt/S30/guojq/methylation/genome --bowtie2 -1 /mnt/S30/guojq/methylation/data/CIBC-CK1/CIBC-CK1_1.fq -2 /mnt/S30/guojq/methylation/data/CIBC-CK1/CIBC-CK1_2.fq -o ./CIBC-CK1 &amp;bismark -p 5 /mnt/S30/guojq/methylation/genome --bowtie2 -1 /mnt/S30/guojq/methylation/data/CIBC-CK2/CIBC-CK2_1.fq -2 /mnt/S30/guojq/methylation/data/CIBC-CK2/CIBC-CK2_2.fq -o ./CIBC-CK2 &amp;bismark -p 5 /mnt/S30/guojq/methylation/genome --bowtie2 -1 /mnt/S30/guojq/methylation/data/CIBC-DT1/CIBC-DT1_1.fq -2 /mnt/S30/guojq/methylation/data/CIBC-DT1/CIBC-DT1_2.fq -o ./CIBC-DT1 &amp;bismark -p 5 /mnt/S30/guojq/methylation/genome --bowtie2 -1 /mnt/S30/guojq/methylation/data/CIBC-DT2/CIBC-DT2_1.fq -2 /mnt/S30/guojq/methylation/data/CIBC-DT2/CIBC-DT2_2.fq -o ./CIBC-DT2 &amp;bismark -p 5 /mnt/S30/guojq/methylation/genome --bowtie2 -1 /mnt/S30/guojq/methylation/data/BURO-CK1/BURO-CK1_1.fq -2 /mnt/S30/guojq/methylation/data/BURO-CK1/BURO-CK1_2.fq -o ./BURO-CK1 &amp;bismark -p 5 /mnt/S30/guojq/methylation/genome --bowtie2 -1 /mnt/S30/guojq/methylation/data/BURO-CK2/BURO-CK2_1.fq -2 /mnt/S30/guojq/methylation/data/BURO-CK2/BURO-CK2_2.fq -o ./BURO-CK2 &amp;bismark -p 5 /mnt/S30/guojq/methylation/genome --bowtie2 -1 /mnt/S30/guojq/methylation/data/BURO-DT1/BURO-DT1_1.fq -2 /mnt/S30/guojq/methylation/data/BURO-DT1/BURO-DT1_2.fq -o ./BURO-DT1 &amp;bismark -p 5 /mnt/S30/guojq/methylation/genome --bowtie2 -1 /mnt/S30/guojq/methylation/data/BURO-DT2/BURO-DT2_1.fq -2 /mnt/S30/guojq/methylation/data/BURO-DT2/BURO-DT2_2.fq -o ./BURO-DT2 ##methylKit分析甲基化差异性表达 对bismark生成的bam文件排序，转化为sam文件，命令: 1234foreach BAM(*_pe.bam)samtools sort $BAM `\basename $BAM .bam`.sortedsamtools view -h `\basename $BAM .bam`.sorted.bam &gt; `\basename $BAM .bam`.sorted.samend 根据sam文件提取甲基化信息，命令如下: 1234567library(methylKit)fns=Sys.glob('*.sam')for(fn in fns)&#123; wri_f=paste( strsplit( fn, '_1_bismark_bt2_pe.sorted.sam', fixed=T )[[1]][1] ,'', sep='') myobj=read.bismark(fn,wri_f,assembly="tair10",save.context="CpG",read.context="CpG",save.fold=getwd()) &#125; read.bismark是methylKit自带的一个方法，可以提取CpG、CHG、CHH甲基化水平，生成包含甲基化水平的txt文件，格式如下：123chrBase|chr|base|strand|coverage|freqC|freqTChr1.500|Chr1|500|F|20|0.00|100.00Chr1.511|Chr1|511|F|22|0.00|100.00 根据甲基化水平文件，生成bedGraph文件 123456789library(methylKit)fns=Sys.glob('*.txt') for(fn in fns)&#123; wri_f=paste( strsplit( fn, '_CpG.txt', fixed=T )[[1]][1] , '', sep='') myobj=methRead(fn,wri_f,"tair10") wri_f=paste( strsplit( fn, '.txt', fixed=T )[[1]][1] , '.bedgraph', sep='') bedgraph(myobj,wri_f,col.name="perc.meth",unmeth=FALSE,log.transform=FALSE,negative=FALSE,add.on="") &#125; 根据甲基化水平文件，计算甲基化差异，找差异表达区域 12345678910111213141516171819202122library(methylKit)file.list1 &lt;- list("BURO-CK1_CpG.txt","BURO-CK2_CpG.txt","BURO-DT1_CpG.txt","BURO-DT2_CpG.txt") file.list2 &lt;- list("CIBC-CK1_CpG.txt","CIBC-CK2_CpG.txt","CIBC-DT1_CpG.txt","CIBC-DT2_CpG.txt")objs1 &lt;- methRead(file.list1,sample.id=list("BURO-CK1","BURO-CK2","BURO-DT1","BURO-DT2"),assembly="tair10",treatment=c(0,0,1,1))objs2 &lt;- methRead(file.list2,sample.id=list("CIBC-CK1","CIBC-CK2","CIBC-DT1","CIBC-DT2"),assembly="tair10",treatment=c(0,0,1,1))regionCounts1 &lt;- tileMethylCounts(objs1 , win.size = 500,step.size = 500)regionCounts2 &lt;- tileMethylCounts(objs2 , win.size = 500,step.size = 500)meth1 &lt;- unite(regionCounts1)meth2 &lt;- unite(regionCounts2)write.table(meth1,"BURO-regionCounts.txt",sep="\t",row.names=FALSE,col.names=TRUE)write.table(meth2,"CIBC-regionCounts.txt",sep="\t",row.names=FALSE,col.names=TRUE)diff1 &lt;- calculateDiffMeth(meth1)diff2 &lt;- calculateDiffMeth(meth2)myDiff1.hyper &lt;- getMethylDiff(diff1,difference=25,qvalue=0.01,type="hyper")myDiff1.hypo &lt;- getMethylDiff(diff1,difference=25,qvalue=0.01,type="hypo")write.table(myDiff1.hyper,"BURO-hyper-diff-region.txt",sep="\t",row.names=FALSE,col.names=TRUE)write.table(myDiff1.hypo,"BURO-hypo-diff-region.txt",sep="\t",row.names=FALSE,col.names=TRUE)myDiff2.hyper &lt;- getMethylDiff(diff2,difference=25,qvalue=0.01,type="hyper")myDiff2.hypo &lt;- getMethylDiff(diff2,difference=25,qvalue=0.01,type="hypo"))write.table(myDiff2.hyper,"CIBC-hyper-diff-region.txt",sep="\t",row.names=FALSE,col.names=TRUE)write.table(myDiff2.hypo,"CIBC-hypo-diff-region.txt",sep="\t",row.names=FALSE,col.names=TRUE]]></content>
      <tags>
        <tag>bismark</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[gff2bed]]></title>
    <url>%2F2017%2F08%2F24%2Fgff2bed%2F</url>
    <content type="text"><![CDATA[BED 文件格式提供了一种灵活的方式来定义的数据行，以用来描述注释的信息。BED行有3个必须的列和9个额外可选的列。 每行的数据格式要求一致。通常所见的bed文件为6列，但是一些软件要求输入12列bed文件(UCSC Genome Browser)，通过探索研究出一下两种从gff3/gtf转为12列bed文件的方法。 ##GFFtools-GX GFFtools-GX是vipints分享在GitHub上的一个程序集，里面包含了gff、gtf、gbk、bed格式之间的相互转换。 在GitHub上，vipints分享了一种使用方式，该方式需要在本地先配置Galaxy Tool shed(具体配置看网站说明，并安装了python2.6或者2.7以及biopython。配置完成后，使用一下命令调用该软件包: 1sh run_functional_tests.sh -id fml_gtf2gff 另一种方式是将软件包下载下来，直接调用软件包中的脚本: 123#Convert genome annotation data in GFF/GTF to a 12 column BED format. BED format typically represents the transcript models. Usage: python gff_to_bed.py in.gff &gt; out.bed python gtf_to_bed.py in.gtf &gt; out.bed 直接下载的软件包中的gff_to_bed.py在运行时会出现以下报错，1TypeError: len() of unsized object 在GitHub上tzintzuni给出了解决方法，修改gff_to_bed.py文件，将以下代码1234567891011121314151617181920212223242526def writeBED(tinfo): """ writing result files in bed format @args tinfo: list of genes @type tinfo: numpy object """ for ent1 in tinfo: child_flag = False for idx, tid in enumerate(ent1['transcripts']): child_flag = True exon_cnt = len(ent1['exons'][idx]) exon_len = '' exon_cod = '' rel_start = None rel_stop = None for idz, ex_cod in enumerate(ent1['exons'][idx]):#check for exons of corresponding transcript exon_len += '%d,' % (ex_cod[1]-ex_cod[0]+1) if idz == 0: #calculate the relative start position exon_cod += '0,' rel_start = int(ex_cod[0])-1 rel_stop = int(ex_cod[1]) else: exon_cod += '%d,' % (ex_cod[0]-1-rel_start) ## shifting the coordinates to zero rel_stop = int(ex_cod[1]) 替换为1234567891011121314151617181920212223242526272829def writeBED(tinfo): """ writing result files in bed format @args tinfo: list of genes @type tinfo: numpy object """ for ent1 in tinfo: child_flag = False for idx, tid in enumerate(ent1['transcripts']): child_flag = True exon_cnt = 0 exon_len = '' exon_cod = '' rel_start = None rel_stop = None if ent1['exons'][idx].ndim &gt; 0: exon_cnt = len(ent1['exons'][idx]) for idz, ex_cod in enumerate(ent1['exons'][idx]):#check for exons of corresponding transcript exon_len += '%d,' % (ex_cod[1]-ex_cod[0]+1) if idz == 0: #calculate the relative start position exon_cod += '0,' rel_start = int(ex_cod[0])-1 rel_stop = int(ex_cod[1]) else: exon_cod += '%d,' % (ex_cod[0]-1-rel_start) ## shifting the coordinates to zero rel_stop = int(ex_cod[1]) 修改后运行脚本，出现以下错误:12 将脚本末尾以下部分代码:123out_print = [ent1['chr'], '%d' % int(ent1['start'])-1, '%d' % int(ent1['stop']), 修改为:123out_print = [ent1['chr'], '%d' % (int(ent1['start'])-1), '%d' % int(ent1['stop']), 即可解决问题。 ##BEDOPSBEDOPS包含了多种工具，最常用的就是convert2bed，可将方便的将gff、gtf、bam等多种格式转换为bed或者starch格式，但在转换为12列bed文件时需要借助UCSC提供的软件包来完成。下载需要的UCSC包:12345#可浏览网址http://hgdownload.cse.ucsc.edu/admin/exe/linux.x86_64/ 查看各种包wget -c http://hgdownload.cse.ucsc.edu/admin/exe/linux.x86_64/gff3ToGenePredwget -c http://hgdownload.cse.ucsc.edu/admin/exe/linux.x86_64/gtfToGenePredwget -c http://hgdownload.cse.ucsc.edu/admin/exe/linux.x86_64/genePredToBedchmod 755 gff3ToGenePred gtfToGenePred genePredToBed 转换gtf文件为bed12:1gtfToGenePred test.gtf test.genePhred &amp;&amp; genePredToBed test.genePhred result.bed &amp;&amp; rm test.genePhred 转换gff文件为bed12:1gtf3ToGenePred test.gff test.genePhred &amp;&amp; genePredToBed test.genePhred result.bed &amp;&amp; rm test.genePhred 如有问题，欢迎交流。]]></content>
      <tags>
        <tag>gfftools</tag>
      </tags>
  </entry>
</search>
